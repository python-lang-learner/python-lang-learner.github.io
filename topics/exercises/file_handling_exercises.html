<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>File handling — Exercises — Python Learning</title>

  <!-- absolute path so pages inside subfolders load correctly -->
  <link rel="stylesheet" href="/styles.css" />
  <style>
    /* small worksheet-specific tweaks */
    main { max-width: 980px; margin:36px auto; padding: 0 18px; }
    h1 { font-size: 30px; margin-bottom: 6px; }
    .meta { color:#5b6b80; margin-bottom: 18px; }
    .controls { display:flex; gap:10px; align-items:center; margin-bottom:18px; }
    button#toggle-all { background:#0f62fe; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600;}
    button#print { background:#e6eefc; color:#0f62fe; border:1px solid #c6ddff; padding:7px 12px; border-radius:8px; cursor:pointer;}
    section.exercise { background:#fff; border-radius:10px; padding:18px; box-shadow: 0 6px 20px rgba(10,20,40,0.05); margin-bottom:14px;}
    details { margin-bottom:12px; }
    details summary { font-weight:600; cursor:pointer; padding:10px 12px; border-radius:8px; background:#f7fbff; }
    details .answer { margin-top:8px; padding:10px 12px; background:#f8f9fb; border-radius:6px; font-family: "Courier New", monospace; white-space:pre-wrap; }
    .hint { font-size:14px; color:#6b7280; margin-top:6px; }
    .small { font-size:13px; color:#6b7280; }
    .footer-note { margin-top:20px; color:#5b6b80; font-size:13px; }
    @media (max-width:640px){ h1{font-size:22px} }
  </style>
</head>
<body>
  <!-- If you have a site header include it here; if using global header skip this -->
  <header class="site-header"></header>

  <main>
    <h1>File handling — Practice worksheet</h1>
    <p class="meta">Short exercises to practice opening, reading, writing and deleting files in Python. Use the "Show/Hide All Answers" button below to reveal answers.</p>

    <div class="controls">
      <button id="toggle-all" aria-pressed="false">Show All Answers</button>
      <button id="print" onclick="window.print()">Print</button>
      <div style="margin-left:auto" class="small">Tip: Press <strong>S</strong> to toggle all answers</div>
    </div>

    <section class="exercise" id="ex1">
      <h2>Exercise 1 — Count words</h2>
      <p class="small">Write a function <code>count_words(path)</code> that returns the number of words in a UTF-8 text file.</p>

      <details>
        <summary>Answer (click to open)</summary>
        <div class="answer">
def count_words(path):
    with open(path, 'r', encoding='utf-8') as f:
        text = f.read()
    return len(text.split())
        </div>
      </details>
    </section>

    <section class="exercise" id="ex2">
      <h2>Exercise 2 — Replace text safely</h2>
      <p class="small">Create <code>replace_in_file(path, old, new)</code> that replaces all occurrences of <code>old</code> with <code>new</code> safely (write to a temp file then replace).</p>

      <details>
        <summary>Answer (click to open)</summary>
        <div class="answer">
from pathlib import Path
import tempfile
import shutil

def replace_in_file(path, old, new):
    path = Path(path)
    with tempfile.NamedTemporaryFile('w', delete=False, encoding='utf-8') as tmp:
        with path.open('r', encoding='utf-8') as r:
            for line in r:
                tmp.write(line.replace(old, new))
    shutil.move(tmp.name, str(path))
        </div>
      </details>
    </section>

    <section class="exercise" id="ex3">
      <h2>Exercise 3 — Merge files</h2>
      <p class="small">Implement <code>merge_files(outpath, *paths)</code> concatenating multiple files to <code>outpath</code>.</p>

      <details>
        <summary>Answer (click to open)</summary>
        <div class="answer">
from pathlib import Path

def merge_files(outpath, *paths):
    out = Path(outpath)
    with out.open('w', encoding='utf-8') as w:
        for p in paths:
            with open(p, 'r', encoding='utf-8') as fh:
                for line in fh:
                    w.write(line)
        </div>
      </details>
    </section>

    <section class="exercise" id="ex4">
      <h2>Exercise 4 — File existence & safe delete</h2>
      <p class="small">Write a function <code>safe_remove(path)</code> that deletes <code>path</code> only if it's inside a permitted directory (avoid deleting arbitrary paths).</p>

      <details>
        <summary>Answer (click to open)</summary>
        <div class="answer">
from pathlib import Path

ALLOWED_DIR = Path('data').resolve()

def safe_remove(path):
    p = Path(path).resolve()
    if ALLOWED_DIR in p.parents or p == ALLOWED_DIR:
        if p.exists():
            p.unlink()
            return True
    return False
        </div>
      </details>
    </section>

    <section class="exercise" id="ex5">
      <h2>Exercise 5 — Read large file lazily</h2>
      <p class="small">Show how to process a large file line-by-line without loading it all to memory (e.g. count lines that contain the word "error").</p>

      <details>
        <summary>Answer (click to open)</summary>
        <div class="answer">
def count_error_lines(path):
    count = 0
    with open(path, 'r', encoding='utf-8') as f:
        for line in f:
            if 'error' in line.lower():
                count += 1
    return count
        </div>
      </details>
    </section>

    <p class="footer-note">Want printable worksheets for students? Use the Print button above — answers are hidden in &lt;details&gt; and will be collapsed by default when printed.</p>
  </main>

  <footer style="max-width:980px;margin:28px auto;padding:0 18px;color:#6b7280;">Python Learning — worksheets</footer>

  <script src="/scripts/answers.js" defer></script>
</body>
</html>
